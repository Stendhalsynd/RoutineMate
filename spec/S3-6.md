# S3-6 Spec - 전역 상태 일원화 + 낙관적 반영 + 템플릿 인라인 수정

## 범위
- 페이지 간 상태 일관성을 위해 Query 캐시를 전역으로 도입한다.
- 세션 관리는 설정 페이지에서만 액션을 제공하고, 나머지 페이지는 읽기 상태만 노출한다.
- 식단/운동/체성분/목표/템플릿 mutation은 낙관적 업데이트 후 실패 시 롤백한다.
- 템플릿 목록에 인라인 수정(`수정/저장/취소`)을 추가한다.
- 대시보드 범위 토글 표기를 `Day/Week/Month`로 맞춘다.
- 기록 페이지 운동/체성분 저장 버튼 상단 간격을 공통 규칙으로 통일한다.
- 초기 진입 깜빡임 완화를 위해 `GET /v1/bootstrap` 스냅샷 API를 도입한다.

## Given / When / Then
1. Given 설정 페이지에서 게스트 세션 시작을 완료하면, When 기록/대시보드로 이동하면, Then 세션 액션 없이 동일 세션으로 데이터가 즉시 보인다.
2. Given 기록 페이지에서 식단/운동/체성분 저장 버튼을 누르면, When 서버 응답 전이면, Then 목록 상태가 먼저 반영된다.
3. Given 서버 저장이 실패하면, When 오류 응답이 오면, Then 직전 상태로 롤백되고 오류 메시지가 노출된다.
4. Given 설정 페이지 템플릿 행에서 수정을 누르면, When 값을 바꾸고 저장하면, Then PATCH API 반영 후 목록이 갱신된다.
5. Given 대시보드를 열면, When 범위 토글을 보면, Then `Day/Week/Month` 라벨이 노출된다.

## 실패 테스트(선작성)
- `apps/web/tests/api-routes.test.ts`
  - `GET /v1/bootstrap` (세션 없음/records view payload)
- `tests/e2e/deploy-verification.spec.ts`
  - 설정 페이지 템플릿 인라인 수정
  - 대시보드/기록 페이지 세션 버튼 미노출
  - 대시보드 토글 라벨 `Day/Week/Month`

## 완료 기준
- typecheck green
- unit/integration/e2e green
- 페이지 이동 후 목표/템플릿/기록이 초기화된 것처럼 보이지 않음
- 템플릿 인라인 수정 동작 확인
- 저장 버튼 간격 규칙(`action-gap`) 통일 확인
