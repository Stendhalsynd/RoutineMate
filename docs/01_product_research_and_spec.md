# RoutineMate 설계 초안 v0.1

## 1) 제품 목표와 문제 정의

### 핵심 목표
- 웹(Vercel 배포) + 모바일(Android APK 설치)에서 동일한 루틴 데이터(식단/운동/체성분/목표)를 끊김 없이 관리.
- "기록의 마찰"을 최소화해 사용자가 꾸준히 입력하도록 유도.
- 대시보드에서 날짜/기간별 진행률을 직관적으로 확인.

### 해결하려는 문제
- 식단 앱: 음식 검색/기록 과정이 번거롭고 반복 입력이 귀찮음.
- 운동 앱: 운동 이름을 잘 모르면 진입 장벽이 높고 루틴 선택이 어려움.
- 기존 서비스: 데이터는 많지만 한눈에 보기 어렵고, 오늘 무엇을 해야 하는지가 모호.

---

## 2) 벤치마크(상용 서비스) 분석

> 아래는 일반적으로 많이 쓰이는 글로벌/국내 서비스의 대표적 UX 패턴을 기준으로 정리한 설계 관점 벤치마크입니다.

### A. MyFitnessPal 계열(칼로리 중심)
**장점**
- 방대한 음식 DB, 바코드 스캔 등 입력 도구가 강력.
- 칼로리/매크로 기반 추적이 명확.

**단점**
- 음식 검색 후보가 너무 많아 선택 피로가 큼.
- 초보자에겐 "정확한 음식명" 입력 자체가 어려움.
- 운동/루틴/목표 달성 흐름이 식단 UX와 분리되는 경우가 많음.

**기회 영역**
- 음식명을 몰라도 "카테고리형 빠른 입력"(예: 한식/분식/샐러드/치킨류).
- 자주 먹는 식단 템플릿 1탭 기록.

### B. Nike Training Club / Freeletics 계열(운동 가이드 중심)
**장점**
- 운동 영상을 통한 학습과 동기부여가 좋음.
- 초보자도 따라하기 쉬운 프로그램 제공.

**단점**
- 실제 개인 기록(세트/중량/반복)과의 연결이 약할 수 있음.
- "오늘 내가 한 운동"을 캘린더 단위로 축적/회고하기가 불편한 경우가 있음.

**기회 영역**
- 가이드 + 기록을 하나의 플로우로 통합.
- "이름을 몰라도 선택 가능"한 운동 선택 UX(부위/도구/난이도 기반).

### C. Strava 계열(활동 기록/커뮤니티 중심)
**장점**
- 기록 시각화와 회고 UX가 강함.
- 습관화와 동기부여 요소(배지/챌린지/피드)가 효과적.

**단점**
- 웨이트/식단 등 라이프로그 통합은 제한적.
- 목표 달성 관리가 특정 활동 타입에 치우치기 쉬움.

**기회 영역**
- 식단 + 운동 + 체중/체지방 + 루틴 성취율을 한 화면에서 통합.

### D. 캘린더/할일 앱(Notion, Todoist 스타일)
**장점**
- 일정/체크 관리가 직관적.
- 반복 루틴 구성에 강함.

**단점**
- 건강 도메인 특화 데이터(칼로리/영양/세트/반복/체성분)가 부족.

**기회 영역**
- 캘린더 가독성은 유지하되 건강 지표를 도메인 특화 위젯으로 제공.

---

## 3) 차별화 전략(핵심)

## 3-1. "기록 마찰 제로" 입력 UX
1. **3초 식단 입력**
   - 텍스트 검색 없이: [식사 유형] + [대표 음식 카드] + [양(대략)]만으로 저장.
   - 예: "점심 / 비빔밥 / 1인분".
2. **이름 몰라도 운동 기록**
   - 신체부위(가슴/등/하체) → 목적(근비대/체지방감량) → 도구(맨몸/덤벨/기구) 순 선택.
   - 후보 운동 자동 추천 + 최근 기록 우선 노출.
3. **최근/자주/루틴 템플릿 원탭 복사**
   - "어제와 동일", "지난주 수요일 복사"를 전면 배치.

## 3-2. "한눈 대시보드" 중심 정보 설계
1. 오늘 할 일(루틴) / 오늘 완료율 / D-day / 주간 성취율을 첫 화면 상단에 고정.
2. 캘린더 셀에 식단/운동/체성분 아이콘과 점수 색상(초록/노랑/빨강) 표시.
3. 기간 필터(7일/30일/90일)로 목표 대비 추세(체중, 체지방, 루틴 달성률) 제공.

## 3-3. "지능형 간소화" 추천
1. **자동 루틴 제안**: 최근 수행률이 높은 루틴을 우선 추천.
2. **누락 감지**: 오늘 기록이 없으면 저녁 시간대에 "1탭 기록" 알림.
3. **과부하 방지**: 입력 항목을 초반 최소화, 고급 옵션은 접어두기.

---

## 4) MVP 기능 범위(웹 + 앱 공통)

### 4-1. 계정/동기화
- 이메일 소셜 로그인(추후 확장), 다중 디바이스 동기화.

### 4-2. 목표 설정
- D-day 목표, 목표 체중, 목표 체지방률, 주간 루틴 목표 횟수.

### 4-3. 기록 기능
- 식단 기록(간편 입력 + 상세 영양 optional).
- 운동 기록(간편 선택 + 세트/반복/중량 optional).
- 체중/체지방 기록.

### 4-4. 캘린더/타임라인
- 날짜별 기록 조회/수정.
- "이전 기록 복사"와 "템플릿 저장".

### 4-5. 대시보드
- 오늘 목표 진행률.
- 주간/월간 달성률.
- 추세 그래프(체중/체지방/운동 빈도/식단 준수율).

### 4-6. 알림
- 기록 리마인더.
- 목표 이탈 경고(예: 3일 연속 미기록).

---

## 5) 권장 기술 아키텍처

### 프론트엔드
- **Web**: Next.js(App Router) + TypeScript + Tailwind + shadcn/ui.
- **Mobile APK(갤럭시)**: React Native(Expo) 또는 Flutter.
  - 웹과 로직/타입 공유를 고려하면 React Native + monorepo가 유리.

### 백엔드
- Next.js API Routes 또는 별도 NestJS/Fastify.
- DB: PostgreSQL(+ Prisma ORM).
- Auth: NextAuth or Supabase Auth.
- 캐시/큐: Redis(알림/집계).

### 배포
- Web/API: Vercel.
- DB: Neon/Supabase/RDS.
- 모바일: EAS Build(Android APK/AAB) 또는 Flutter build pipeline.

---

## 6) 데이터 모델 초안

- `users`
- `goals` (d_day, target_weight, target_body_fat, weekly_routine_target)
- `meal_logs` (date, meal_type, food_label, amount, kcal, protein, carb, fat)
- `workout_logs` (date, body_part, exercise_name, sets, reps, weight)
- `body_metrics` (date, weight, body_fat)
- `routine_templates` (name, items)
- `daily_scores` (date, diet_score, workout_score, overall_score)

핵심 원칙:
- "빠른 입력 필드"와 "상세 필드"를 분리해 저장.
- 통계 계산용 materialized view(또는 집계 테이블) 운영.

---

## 7) UX 설계 원칙

1. **기록 우선**: 앱 첫 진입 시 기록 버튼이 가장 먼저 보이게.
2. **인지 부하 최소화**: 선택지는 단계적으로 노출.
3. **회고 가능성 강화**: 캘린더 + 타임라인 + 그래프를 같은 데이터로 연결.
4. **초보자 친화 문구**: 전문 용어 대신 쉬운 표현(예: "등 운동" 우선).

---

## 8) TDD 기반 개발 원칙(요청 반영)

1. Spec 작성(유저스토리 + 인수조건) → 실패 테스트 작성.
2. 최소 구현으로 테스트 통과.
3. 리팩터링 + 회귀 테스트.
4. PR 단위로 "기능 테스트 + UX 체크리스트" 강제.

---

## 9) 리스크와 대응

- 음식 DB 정확도: 초반엔 간편 카테고리 입력 우선, 상세 영양은 선택.
- 운동 DB 표준화: 이름 사전 + 동의어 매핑(예: 풀업/턱걸이).
- 입력 피로: 자동완성/최근 기록 복사/알림 최적화.

---

## 10) 먼저 확인이 필요한 의사결정(질문)

1. 초기 타깃: 헬스 초보자 중심인가, 중급 이상 기록러 중심인가?
2. 식단 정확도 우선순위: "대략 기록" vs "영양 정밀 기록" 중 어느 쪽이 핵심인가?
3. 모바일 구현: React Native(웹 공유 최적화) vs Flutter(UI 유연성) 선호?
4. 로그인 정책: 소셜 로그인 필수인지, 익명/게스트 시작 허용할지?
5. MVP 출시 시점: 1차 목표 기간(예: 6주/8주/12주)은?


---

## 11) S3-5 IA/모델 업데이트 (2026-03-01)

### 정보 구조(IA)
- 기존: 단일 랜딩/기록 혼합 페이지
- 변경: 3페이지 분리
  - `/dashboard`: KPI + 버킷 추세(day/week/month) + 목표 read-only 카드
  - `/records`: 식단 체크인/운동/체성분 기록 및 삭제
  - `/settings`: 목표 설정 + 템플릿(식단/운동) 관리

### 식단 모델 변경
- 기존: `foodLabel` 텍스트 입력 중심
- 변경: `meal-checkin` 중심
  - 슬롯 고정: `breakfast`, `lunch`, `dinner`, `dinner2`
  - 상태: `completed=true|false`
  - 템플릿 선택 시 1탭 저장
- `POST /v1/meal-logs/quick`는 하위호환 유지

### 집계 표기 규칙
- range는 그대로 유지: `7d`, `30d`, `90d`
- 시각화 단위는 자동 전환
  - `7d -> day`
  - `30d -> week(ISO week, 월요일 시작)`
  - `90d -> month(YYYY-MM)`
- 대시보드 응답에 `granularity`, `buckets`를 포함

### 삭제 정책
- 삭제는 hard delete가 아닌 soft delete
- 공통 필드: `IsDeleted(Checkbox)`, `DeletedAt(Date)`
- 대상: meal checkin/meal log, workout log, body metric

### 템플릿 정책
- 설정 페이지에서만 템플릿 생성/비활성화
- 기록 페이지에서는 활성 템플릿만 빠른 선택
- 템플릿 유형
  - `MealTemplate(label, mealSlot)`
  - `WorkoutTemplate(label, bodyPart, purpose, tool, defaultDuration)`

---

## 12) S3-6 UX/상태 업데이트 (2026-03-01)

### 상태 일관성
- 페이지별 로컬 상태 중심에서 전역 query cache 중심으로 전환.
- 세션/목표/기록/템플릿을 페이지 경계를 넘어 동일 캐시로 공유.

### 세션 UX
- 세션 액션(`게스트 세션 시작`, `세션 확인`)은 설정 페이지에서만 노출.
- 기록/대시보드는 세션 읽기 상태만 표시.

### 즉시 반영 UX
- 저장 액션은 낙관적 업데이트를 기본값으로 적용.
- 서버 실패 시 직전 상태로 롤백하고 명시 오류 메시지 노출.

### 템플릿 관리 UX
- 템플릿은 추가/비활성화에 더해 인라인 수정(`수정/저장/취소`) 제공.

### 대시보드 표기
- 내부 범위값은 `7d/30d/90d`를 유지.
- 사용자 노출 토글은 `Day/Week/Month` 라벨로 표시.

---

## 13) S4 확장 방향 (2026-03-01)

### S4-1 리마인더 루프
- 정책: `고정 시간 1회 + 미기록 감지 알림`.
- 채널: `web_in_app`, `web_push`, `mobile_local`.
- 저장: `ReminderSettings` 전용 DB로 사용자별 정책 관리.

### S4-2 Google 계정 전환
- 게스트 시작 후 설정 페이지에서 Google 계정으로 전환.
- 세션 메타 확장: `AuthProvider`, `ProviderSubject`, `AvatarUrl`.
- 동일 Google 계정 재로그인 시 기존 데이터 사용자로 복원.

### S4-3 즉시 반영 UX
- 페이지 이동 시 빈 상태 깜빡임을 줄이기 위해 캐시 우선 렌더를 유지.
- 저장 버튼 공통 여백/상태 피드백 규칙을 통일.
- 접근성: 상태 메시지 `aria-live`, 터치 타겟 44px+.

### S4-4 웹+APK 동시 릴리즈
- 웹: Vercel + Playwright 배포 검증 루프.
- 모바일: EAS APK 빌드(`preview`, `release`) + GitHub Release 첨부.
- 릴리즈 노트는 Discord webhook으로 동시 공유.
